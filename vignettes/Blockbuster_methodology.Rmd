---
title: "Blockbuster Deterioration Model Methodology"
author: "Peter Curtis"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette provides detailed information on how the Blockbuster Deterioration Model works. 

# Overview

The Blockbuster Deterioration Model simulates the deterioration of individual building components (walls, roofs, etc) on a yearly basis. 

A component can be in one of five conditions:

| Grade | Condition |
|---|:---|
| A | Excellent |
| B | Acceptable |
| C | Requires maintenance |
| D | Poor |
| E | (optional) Failed |

Every component has associated deterioration rates which give the probability that
the component will drop from its current grade to the next worse within a year. For example, in the following figure we see that
this wall has a 9.5% chance of dropping to grade D within a year if it is at grade C.

```{r out.width = "100%", echo = FALSE}
knitr::include_graphics("images/wall with deterioration rates.png")
```

During simulation, the Blockbuster Deterioration Model does not store the current grade of all components, but instead it stores the **probability** that a component is at each grade. This is for computational reasons.  For more information on a variant model approach that instead stores **grades** rather than **probability of grades** see the section on the [Monte Carlo approach](#Montecarlo), but be aware that it is only suitable for simulating individual blocks.

The following flowchart describes how each component is simulated.

```{r out.width = "100%", echo = FALSE}
knitr::include_graphics("images/Flowchart for single element.png")
```

Components are first deteriorated, then the Blockbuster Deterioration Model determines which buildings will be rebuilt.  It
makes this decision based on the probable condition and cost associated with the other modelled components and the user-input 
funding allocated for the yearly **rebuilding** budget. The model rebuilds blocks in order of cost-efficiency which is measured as the ratio between the expected cost to repair all components in a block and the cost to rebuild the block.  For more detail on how it makes these decisions, see the section on [rebuilding](#rebuild).

Then, the Blockbuster determines which components will be repaired.  Again, it makes these decisions based on the state of the other modelled components and the user-input yearly **repair** budget. Standard behaviour is to simulate planned and preventative maintenance by assessing the expected cost of repairing all grade B components.  These components are repaired if there is money left, the model moves on to grades C, D, and finally E. This behaviour is modifiable. For more detail on how it makes these decisions, see the section on [rebuilding](#rebuild).

At the end of this process we are left with updated probabilities that a component is at 
a particular grade.  This process is then repeated according for each year we wish to simulate.

The model output consists of a set of probabilities for each component.  For example, a wall could start at grade B (as represented by the probabilities in the below table).

| Component | Prob. at A | Prob. at B | Prob. at C | Prob. at D | Prob. at E |
|:---|---:|---:|---:|---:|---:|
| Concrete Wall | 0 | 1 | 0 | 0 | 0 |

After a few years of deterioration something like the following table could be expected.

| Component | Prob. at A | Prob. at B | Prob. at C | Prob. at D | Prob. at E |
|:---|---:|---:|---:|---:|---:|
| Concrete Wall | 0.15 | 0.47 | 0.13 | 0.18 | 0.07 |

When combined with information on the cost of repairing components of all types at all grades, and the relative size of all components, it allows us to estimate the backlog associated with the modelled components.

## Assumptions

The methodology stated above implies several assumptions.

### General 
- There is no geographic component within the model.  Money for repairs and rebuilding is
allocated strictly by the ranking of components and blocks.  There are no adjustments to maintenance costs and rebuilding costs due to location. Geographic and administrative information is available for all schools so rules could be formulated to
better reflect reality.
- It is assumed that the supplied budgets are to be applied to the data supplied.  The PDS data covers ~85% of the school estate so inputs should be adjusted accordingly if the entirety of the PDS data is used for the initial state.

### Deterioration
- Deterioration probabilities are set for component types and grades. Therefore all components of the same type and grade deteriorate at the same rate.

*Counterexample:* the roof of a school in an area
with more rain / snow / hail / wind is likely to degrade faster than the roof of 
a school with a better climate.  Therefore we are assuming to some extent that
the design of a building is ameliorating the impact of local factors on degradation.

- Each component in the estate deteriorates independently of other components.

*Counterexample:* A leaky
roof is likely to result in damage to components it is protecting.

- The deterioration probability is higher for a component in worse condition. This is the general industry thought on component degradation, but could
be incorrect (it could be confounded by the idea that preventative maintenance is
more effective than reactive maintenance - a regularly maintained component stays
at a higher grade for longer than one that is not maintained and is therefore in
poorer condition).
- The size and type of a building does not affect the deterioration probabilities.
- The deterioration probabilities of components assumes that all components are
subject to the same general level of small maintenance and patchwork projects that are not
captured within the Capital budget.

### Rebuilding
- There is a fixed rebuild cost per sq.m for buildings.

*Counterexample:* London costs should be higher. Applying location factors to rebuild costs is feasible in the model and will be added later.

- Blocks are rebuilt to the exact same specification: same size, and same components.

### Repairs
- Components are repaired independently.

*Counterexample:* If you have to fix the 
built-in lights, you may as well repair the ceiling they are part of too.

- Each component has a fixed repair cost per sq.m.

*Counterexample:* Maintenance could be more expensive in London. Location factors can be built into the model if required to reflect the additional cost of maintenance in, say, London.

- Repairing a component costs more as the component condition worsens.  This can
be adjusted by changing the model parameters.


<!-- ## Input format -->

<!-- # Deterioration {#deterioration} -->

<!-- # Repair decisions {#repair} -->

<!-- # Rebuild decisions {#rebuild} -->

<!-- # Monte Carlo variation {#Montecarlo} -->
